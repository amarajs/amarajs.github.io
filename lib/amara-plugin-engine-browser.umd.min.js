!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AmaraBrowser=t()}(this,function(){function e(e,t){return{type:e,payload:t}}function t(e,t){if(!t)return e;var r=new Set(e);return t.forEach(r.delete,r),r}function r(e){this.result=this.result&&this.set.has(e)}function a(e,t){var a={result:!0,set:t};return e.forEach(r,a),a.result&&t.size===e.size}function n(e){var t=this,r=t.map,a=t.value,n=r.get(e)||new Set;n.add(a),r.set(e,n)}function o(e,t){e.forEach(n,{map:this,value:t})}function f(e,t){e.clear(),t.forEach(o,e)}function i(){return function(r){function o(e){for(var t,r,a,n,o=e.targets,f=o.length;n=o[--f];)if(r=n.match(q))for(r=r.slice(1),a=r.length;t=r[--a];)k.add(t)}function i(e){var t=k.size;e.forEach(o),k.size!==t&&y()}function c(e,r){M.set(r,t(e,this))}function u(t){t.size&&(t.forEach(T.delete,T),M.forEach(c,t),r(e("engine:targets-removed",Array.from(t))))}function s(e){var t=e.targets.join(", "),r=new Set(A.querySelectorAll(t));A.matches(t)&&r.add(A),M.set(e,r)}function h(t){var a={};a[this.type]=new Map([[t,[]]]),r(e("core:apply-target-results",a))}function p(a,n){var o=M.get(n),f=t(a,o);f.size&&r(e("core:clear-cache",{feature:n,targets:f})),f.forEach(h,n)}function d(e,t){var r=this,n=r.prevTargets,o=r.featuresToApply,f=n.get(t)||new Set;e.size&&!a(e,f)&&o.set(t,e)}function l(t){if(void 0===t&&(t=j),A){var a=new Map(M),n=new Map;if(t.forEach(s),a.forEach(p),M.forEach(d,{prevTargets:a,featuresToApply:n}),f(T,M),n.size){z(n);var o=[];n.forEach(function(e,t){return o.push({feature:t,targets:Array.from(e)})}),r(e("core:enqueue-apply",o))}}}function v(e){for(var t,r=new Set,a=e.length;t=e[--a];)Array.from(t.removedNodes).filter(T.has,T).forEach(r.add,r);u(r),l()}function y(){A&&(S&&S.disconnect(),S=new window.MutationObserver(v),S.observe(A,{subtree:!0,childList:!0,attributes:!0,attributeFilter:Array.from(k)}))}function g(t){var a=t.target;A=a,r(e("engine:append-observed-attributes",k)),y(),l()}function m(e){e.forEach(j.add,j),i(e),l(e)}function w(e){var t=M.get(e);return e!==this&&e.type===this.type&&t&&t.size>0}function E(e){var t=this,r=t.feature,a=t.map;Array.from(T.get(e)||new Set).filter(w,r).forEach(n,{map:a,value:e})}function b(e,t,r){var a=M.get(t);if(a&&a.forEach(e.add,e),0===e.size)return r.delete(t);e.forEach(E,{map:r,feature:t})}function z(e){e.forEach(b)}var A,S,M=new Map,T=new Map,j=new Set,k=new Set(["class"]),q=/\[([^=\]]+?)[~^$|*=\]]/;return function(e){switch(e.type){case"core:bootstrap":g(e.payload);break;case"core:features-added":m(e.payload);break;case"core:populate-feature-targets":z(e.payload)}}}}return i});
//# sourceMappingURL=amara-plugin-engine-browser.umd.min.js.map