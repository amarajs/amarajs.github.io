!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AmaraRouter=t()}(this,function(){function e(e){var t=this.object[e];void 0===t&&e in this.result||(this.result[e]=t)}function t(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];for(var n,a=0,o=Object.create(null);n=t[a++];)Object.keys(n).forEach(e,{result:o,object:n});return o}function r(e,t){for(var r=Object.create(null),n=e&&e.length||0,a=0;e&&a<n;a++)r[e[a]]=t[a];return r}function n(e,t){for(var r=[],n=arguments.length-2;n-- >0;)r[n]=arguments[n+2];try{return e.apply(t,r)}catch(e){return e}}function a(e){var t,r=decodeURIComponent(e);if(v.test(r))return new Date(r);if(h.test(r)){if(t=n(JSON.parse,JSON,r),g.call(t)===m.Error)return;return t}return r}function o(e){return e.replace(p,"\\$&")}function c(e){return e.split(String(this))}function i(e){return e.substring(Number(this))}function u(e){var t=this,r=t.params,n=t.parts,a=r[e],o=encodeURIComponent(e)+"=";switch(g.call(a)){case m.Nil:case m.Undef:return;case m.Bool:a&&n.push(encodeURIComponent(e));break;case m.Array:case m.Object:return n.push(o+encodeURIComponent(JSON.stringify(a)));case m.Date:return n.push(o+a.toISOString());default:return n.push(o+encodeURIComponent(a))}}function s(e){void 0===e&&(e={});var t={params:e,parts:[]};return Object.keys(e).sort().forEach(u,t),t.parts.length&&"?"+t.parts.join("&")||""}function f(e,t){var r=t[0],n=t[1];return void 0===n&&(n="true"),e[r]=a(n),e}function l(e,t){function r(e){var r=(e.match(t)||[]).slice(1),n=r[0],a=r[1];void 0===a&&(a="");var o=(a.match(b)||[]).slice(1),i=o[0],u=o[1];return void 0===u&&(u=""),{target:n,route:i,params:u.split("&").map(c,"=").filter(w).reduce(f,{})}}function n(t){return t.replace(e.hashPrefix,"").split(e.selectorBetween).filter(Boolean).map(r)}function a(t){var r=t.target,n=t.route,a=t.params;void 0===a&&(a={});var o=s(a);return""+r+e.selectorWithin+n+o}function o(t){return e.hashPrefix+t.map(a).join(e.selectorBetween)}return{getHashData:n,getHashString:o}}function d(e){void 0===e&&(e=E);var n=new RegExp("(.+?)"+o(e.selectorWithin)+"(.+)"),c=new RegExp(["^",o(e.hashPrefix),"(.+?",o(e.selectorWithin),"[^?]+?\\??\\S+?(",o(e.selectorBetween),"|$))+"].join("")),u=l(e,n),s=u.getHashData,f=u.getHashString;return function(e){function n(e){for(var t,r=[],n=e&&e.parentElement;n;)t=U.get(n),t&&r.unshift(t),n=n.parentElement;return r}function o(e){var r=n(e),a=U.get(e)||{};return Object.freeze(t.apply(void 0,r.concat([a])))}function u(e,t){t.removeAttribute("route")}function l(e){if(!c.test(e)&&(e||A)){var t=window.document,r=window.history,n=window.location;return U.clear(),B.forEach(u),r.replaceState(null,t.title,n.pathname+n.search)}}function d(e){var n=this,o=n.el,c=n.route,u=n.params,s=n.routeData,f=new RegExp(e.replace(j,"/([^/]+)"));if(!s.active&&f.test(c)){var l=(c.match(f)||[]).slice(1).map(a),d=(e.match(j)||[]).map(i,y);s.active=!0,U.set(o,t(u,r(d,l))),o.getAttribute("route")!==c&&o.setAttribute("route",c)}}function p(e){var t=e.target,r=e.route,n=e.params;void 0===n&&(n={});var a=this,o=a.el,c=a.routeData;o.matches(t)&&c.routes.forEach(d,{el:o,route:r,params:n,routeData:c})}function h(e,t){e.active=!1,this.forEach(p,{el:t,routeData:e})}function v(e){U.delete(e),e.removeAttribute("route")}function m(e,t){!e.active&&v(t)}function g(e,t){if(this.includes(t)){var r=t;U.delete(r),B.delete(r)}}function b(e){B.forEach(g,e)}function w(e){if(c.test(e)){var t=s(e);B.forEach(h,t),B.forEach(m)}}function E(t){A!==t&&e({type:"core:change-occurred",payload:"routeParams"})}function O(){var e=window.document.location.hash;l(e),w(e),E(e),A=e}function S(e,t){var r=(n=[]).concat.apply(n,e);r.length?B.set(t,{routes:r,active:!1}):(v(t),B.delete(t));var n}function x(e){e.forEach(S),O()}function D(e){return e.target===String(this)}function R(e){var t=e.target,r=s(window.document.location.hash),n=r.findIndex(D,t);n>=0&&r.splice(n,1,e)||r.push(e),window.document.location.hash=f(r)}var A=null,B=new Map,U=new Map;return window.addEventListener("hashchange",O),function(e){switch(e.type){case"core:bootstrap":e.payload.register("routeParams",o);break;case"core:apply-target-results":e.payload.route&&x(e.payload.route);break;case"engine:append-observed-attributes":e.payload.add("route");break;case"engine:targets-removed":b(e.payload);break;case"router:navigate":R(e.payload)}}}}var p=/[\\"'\/|]/g,h=/^[\{\["]|^(true|false|null|\d+)$/,v=/^\d{4}-\d{2}-\d{2}T\d\d:\d\d:\d\d\.\d{3}Z$/,m={Nil:"[object Null]",Date:"[object Date]",Bool:"[object Boolean]",Array:"[object Array]",Error:"[object Error]",Undef:"[object Undefined]",Object:"[object Object]"},g=Object.prototype.toString,b=/([^?]+)\??(.*)/,w=function(e){return e[0]},y=2,j=/\/:([^\/]+)/g,E=Object.freeze({hashPrefix:"#!",selectorWithin:"://",selectorBetween:"||"});return d});
//# sourceMappingURL=amara-plugin-router.umd.min.js.map