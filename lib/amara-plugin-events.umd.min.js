!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AmaraEvents=t()}(this,function(){function e(e){return this.matches(e)}function t(e){switch(e){case"space":return" ";case"left":return"0";case"middle":case"wheel":return"1";case"right":return"2";default:return e}}function r(e){switch(e){case"del":return"delete";default:return e}}function a(e){this.target.removeEventListener(this.type,e)}function n(e,t){e.forEach(a,{target:this,type:t})}function i(e){throw new Error(e)}function o(){return function(a){function o(e){!e.type.startsWith("amara:")&&a(e.detail)}function l(e,t){A=!1,e(t,{}),A=!0}function p(e,t){t.orig={setAttribute:e.setAttribute,removeAttribute:e.removeAttribute},t.disabled=e.hasAttribute("disabled"),e.removeAttribute("disabled"),e.setAttribute=function(r,a){if("disabled"!==r)return t.orig.setAttribute.call(e,r,a);t.disabled=!0},e.removeAttribute=function(r){if("disabled"!==r)return t.orig.removeAttribute.call(e,r);t.disabled=!1}}function f(e,t){e.setAttribute=t.orig.setAttribute,e.removeAttribute=t.orig.removeAttribute,t.disabled?e.setAttribute("disabled",""):e.removeAttribute("disabled")}function b(e){return function(t,r){void 0===r&&(r={bubbles:!0,cancelable:!0,composed:!0}),A&&i("Event actions must be dispatched synchronously."),r.detail=t;var a={},n=new window.CustomEvent(t.type,r);g&&g.addEventListener(t.type,o),p(e,a);var s=e.dispatchEvent(n);return f(e,a),g&&g.removeEventListener(t.type,o),s}}function h(a){function n(t){var a,n=r(String(t[u[t.type]]).toLowerCase());if((!E.length||E.some(e,t.target))&&(!C.length||C.includes(String(n).toLowerCase())))return A=!1,t.dispatch=h,a=g.call(this,t),A=!0,a}var o,l,p=this,f=p.map,b=p.target,h=p.dispatcher,m=(s.exec(a)||[]).slice(1),v=m[0],y=m[1];void 0===y&&(y="");var g=f[a],E=y.split(",").map(c).filter(Boolean),k=v.split(".").map(d).map(t),L=k[0],C=k.slice(1);L.startsWith("amara:")&&E.length&&i("amara:* events must not be delegated"),l=w.get(b),l||(this.added=!0,w.set(b,l=new Map)),o=l.get(L),o||l.set(L,o=[]),b.addEventListener(L,n),o.push(n)}function m(e){this.map=e,Object.keys(e).forEach(h,this)}function v(e,t){var r={target:t,added:!1,dispatcher:b(t)},a=w.get(t);a&&a.forEach(n,t),a&&a.clear(),(i=[]).concat.apply(i,e).forEach(m,r),r.added&&l(r.dispatcher,{type:"amara:add"}),l(r.dispatcher,{type:"amara:apply"});var i}function y(e){var t=w.get(e);t&&(l(b(e),{type:"amara:remove"}),w.delete(e),t.forEach(n,e),t.clear())}var g=null,A=!0,w=new WeakMap;return function(e){switch(e.type){case"core:bootstrap":g=e.payload.target;break;case"core:apply-target-results":e.payload.events&&e.payload.events.forEach(v);break;case"engine:targets-removed":e.payload.forEach(y)}}}}var s=/(^[^\s]+)\s*?(.*?)$/,u={keydown:"key",keyup:"key",keypress:"key",mousedown:"button",mouseup:"button"},c=function(e){return e.trim()},d=function(e){return e.trim().toLowerCase()};return o});
//# sourceMappingURL=amara-plugin-events.umd.min.js.map